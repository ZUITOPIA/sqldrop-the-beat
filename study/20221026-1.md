> 20221025 기록 : 반정규화와 성능

### 반정규화를 통한 성능향상 전략

반정규화(역정규화, De-Normalization) ?

- 정규화된 엔터티, 속성, 관계에 대해 시스템의 성능향상과 개발/운영의 단순화를 위해 중복, 통합, 분리 등을 수행하는 기법 (오히려 데이터를 중복하여 데이터 조회 성능을 향상시키기 위함)
- 설계단계에서 수행함

데이터 무결성이 깨질 수 있음에도 불구하고 반정규화 하는 경우

- 데이터를 조회할 때 디스크 I/O 량이 많아서 성능 저하가 예상될 때
- 경로가 너무 멀어 조인으로 인한 성능 저하가 예상될 때
- 칼럼을 계산하여 읽는 과정에서 성능 저하가 예상될 때

반정규화를 기술적으로 수행하지 않는 경우

- 성능이 저하된 데이터베이스가 생성될 수 있음
- 구축단계나 시험단계에서 반정규화를 적용할 때 노력비용이 많이 들게 됨 (수정할게 많음)

### 반정규화의 적용 방법

반정규화를 적용할 때는 **데이터의 무결성을 보장**할 수 있는 방법을 고려한 후 적용하도록 해야함

|     반정규화 순서     |                                  방법                                   |
| :-------------------: | :---------------------------------------------------------------------: |
| 1. 반정규화 대상조사  | 범위처리빈도수, 대량의 범위처리, 통계성 프로세스, 테이블 조인 개수 조사 |
| 2. 다른 방법유도 검토 |       뷰 테이블, 클러스터링 적용, 인덱스의 조정, 응용애플리케이션       |
|   3. 반정규화 적용    |            테이블 반정규화, 속성의 반정규화, 관계의 반정규화            |

1. 반정규화 대상조사, 반정규화 고려해야 할 4가지 경우

   - 자주 사용되는 테이블에 접근하는 프로세스의 수가 많고 항상 일정한 범위만을 조회하는 경우
   - 테이블에 대량의 데이터가 있고 대량의 데이터 범위를 자주 처리할 때 처리범위를 일정하게 줄이지 않으면 성능을 보장할 수 없을 경우
   - 통계성 프로세스에 의해 통계 정보를 필요로 할 때 -> 별도의 통계테이블(반정규화 테이블) 생성
   - 테이블에 지나치게 많은 조인이 걸려 데이터 조회 작업이 기술적으로 어려울 경우

2. 다른 방법유도 검토, 가급적이면 데이터 무결성을 깨뜨릴 위험을 제어하기 위해 반정규화가 아닌 다른 방법으로 처리할 수 있는지 모색

   - 지나치게 많은 조인이 걸려 데이터 조회 작업이 기술적으로 어려운 경우 -> 뷰 사용
   - 대량의 데이터처리/부분처리에 의해 성능이 저하되는 경우 -> 클러스터링 적용하거나 인덱스를 조정  
     (클러스터링 : 데이터 입력, 수정, 삭제할 경우 성능이 많이 저하되므로 조회중심의 테이블일 때나 인덱스를 통한 성능향상이 불가능할 때 만 고려)

   - 대량의 데이터는 PK 성격에 따라 부분적인 테이블로 분리 (파티셔닝 기법, Partitioning)
   - 로직 구사 방법을 변경 (e.g. 데이터 처리하기 위한 값을 캐쉬, 중간 클래스 영역에 데이터를 캐쉬해 공유하게 함)  
     -> 다른 방법이 없다면 반정규화를 적용함

...
